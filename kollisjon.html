<!doctype html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kollisjon: to kuler</title>
  <style>
    :root {
      --bg: #f7fafc; --card: #fff; --text: #1f2937; --muted: #6b7280;
      --primary: #2563eb; --radius: 12px;
    }
    body { margin:0; font-family: system-ui, sans-serif; background: var(--bg); color: var(--text); }
    .layout {
      max-width: 980px; margin: 2rem auto; padding: 0 1rem;
      display: grid; grid-template-columns: 1fr 320px; gap: 1rem;
    }
    .card { background: var(--card); border-radius: var(--radius); box-shadow: 0 8px 24px rgba(0,0,0,.06);
      border:1px solid #e5e7eb; }
    header.card { padding: 1rem 1.25rem; grid-column: 1 / -1; }
    h1 { margin:0 0 .25rem 0; font-size: 1.6rem; }
    p { margin:.25rem 0; color: var(--muted); }
    canvas { display:block; width:100%; height:420px; }
    .panel { padding: 1rem 1.25rem; }
    .row { margin-bottom: .8rem; }
    .row label { display:block; font-weight:600; margin-bottom:.25rem; }
    .row input[type="range"] { width:100%; }
    .stats { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; background:#f8fafc; border:1px solid #e5e7eb; border-radius:10px; padding:.75rem; }
    .buttons { display:flex; gap:.5rem; margin-top:.6rem; }
    button, select {
      padding:.55rem .8rem; border-radius:10px; border:1px solid #d1d5db; background:#fff; cursor:pointer;
    }
    button.primary { background: #2563eb; color:#fff; border-color:#1d4ed8; }
  </style>
</head>
<body>
  <header class="card">
    <h1>Kollisjon mellom to kuler</h1>
    <p>Juster masser og hastigheter. Trykk Start. Se fart (v), bevegelsesmengde (p) og kinetisk energi (Ek) før og etter støt.</p>
  </header>

  <div class="layout">
    <div class="card">
      <canvas id="scene" width="640" height="420" aria-label="Simulert kollisjon"></canvas>
    </div>

    <aside class="card panel">
      <div class="row">
        <label for="m1">Masse m1 (kg): <span id="m1Val">2.0</span></label>
        <input type="range" id="m1" min="0.5" max="10" step="0.5" value="2">
      </div>
      <div class="row">
        <label for="m2">Masse m2 (kg): <span id="m2Val">3.0</span></label>
        <input type="range" id="m2" min="0.5" max="10" step="0.5" value="3">
      </div>
      <div class="row">
        <label for="v1">Startfart v1 (m/s): <span id="v1Val">3.0</span></label>
        <input type="range" id="v1" min="-10" max="10" step="0.5" value="3">
      </div>
      <div class="row">
        <label for="v2">Startfart v2 (m/s): <span id="v2Val">-2.0</span></label>
        <input type="range" id="v2" min="-10" max="10" step="0.5" value="-2">
      </div>
      <div class="row">
        <label for="mode">Støttype</label>
        <select id="mode">
          <option value="elastic">Elastisk (p og Ek bevares)</option>
          <option value="inelastic">Perfekt inelastisk (kleber)</option>
        </select>
      </div>
      <div class="buttons">
        <button id="start" class="primary">Start</button>
        <button id="reset">Reset</button>
        <button id="pause">Pause</button>
      </div>

      <div class="row">
        <div class="stats" id="stats">
          <div>Før støt:</div>
          <div>v1 = …, p1 = …, Ek1 = …</div>
          <div>v2 = …, p2 = …, Ek2 = …</div>
          <hr>
          <div>Etter støt:</div>
          <div>v1' = …, p1' = …, Ek1' = …</div>
          <div>v2' = …, p2' = …, Ek2' = …</div>
          <hr>
          <div>Total p: … | Total Ek: …</div>
        </div>
      </div>
    </aside>
  </div>

  <script>
    const canvas = document.getElementById('scene');
    const ctx = canvas.getContext('2d');

    // UI refs
    const m1El = document.getElementById('m1');
    const m2El = document.getElementById('m2');
    const v1El = document.getElementById('v1');
    const v2El = document.getElementById('v2');
    const modeEl = document.getElementById('mode');
    const m1Val = document.getElementById('m1Val');
    const m2Val = document.getElementById('m2Val');
    const v1Val = document.getElementById('v1Val');
    const v2Val = document.getElementById('v2Val');
    const stats = document.getElementById('stats');
    const startBtn = document.getElementById('start');
    const resetBtn = document.getElementById('reset');
    const pauseBtn = document.getElementById('pause');

    // Sim params
    let m1 = parseFloat(m1El.value);
    let m2 = parseFloat(m2El.value);
    let v1 = parseFloat(v1El.value);
    let v2 = parseFloat(v2El.value);
    let mode = modeEl.value; // 'elastic' | 'inelastic'

    let running = false;
    let paused = false;

    const radius1 = 26, radius2 = 26;
    const leftBound = 40, rightBound = canvas.width - 40;
    let x1 = canvas.width * 0.3, x2 = canvas.width * 0.7;
    const y = canvas.height / 2;

    // Helper math
    const p = (m, v) => m * v;
    const Ek = (m, v) => 0.5 * m * v * v;

    function updateLabels() {
      m1Val.textContent = m1.toFixed(1);
      m2Val.textContent = m2.toFixed(1);
      v1Val.textContent = v1.toFixed(1);
      v2Val.textContent = v2.toFixed(1);
    }

    function draw() {
      ctx.clearRect(0,0,canvas.width, canvas.height);

      // Bakgrunn og bane
      ctx.fillStyle = '#eef2ff';
      ctx.fillRect(0, y-40, canvas.width, 80);
      ctx.strokeStyle = '#c7d2fe';
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(leftBound, y);
      ctx.lineTo(rightBound, y);
      ctx.stroke();

      // Piler for fart
      const arrow = (x, v, color) => {
        const scale = 10; // px per m/s
        const len = Math.max(12, Math.min(120, Math.abs(v) * scale));
        const dir = Math.sign(v) || 1;
        ctx.strokeStyle = color;
        ctx.fillStyle = color;
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(x, y - 55);
        ctx.lineTo(x + dir*len, y - 55);
        ctx.stroke();
        // Pilspiss
        ctx.beginPath();
        ctx.moveTo(x + dir*len, y - 55);
        ctx.lineTo(x + dir*len - 8*dir, y - 60);
        ctx.lineTo(x + dir*len - 8*dir, y - 50);
        ctx.closePath();
        ctx.fill();
      };

      // Kule 1
      ctx.fillStyle = '#60a5fa';
      ctx.beginPath();
      ctx.arc(x1, y, radius1, 0, Math.PI * 2);
      ctx.fill();
      // Kule 2
      ctx.fillStyle = '#f59e0b';
      ctx.beginPath();
      ctx.arc(x2, y, radius2, 0, Math.PI * 2);
      ctx.fill();

      // Fartspiler
      arrow(x1, v1, '#2563eb');
      arrow(x2, v2, '#b45309');

      // Tekstinfo over kulene
      ctx.font = '13px ui-monospace, monospace';
      ctx.textAlign = 'center';
      ctx.fillStyle = '#374151';
      ctx.fillText(`v1=${v1.toFixed(2)} m/s`, x1, y - 75);
      ctx.fillText(`v2=${v2.toFixed(2)} m/s`, x2, y - 75);
    }

    function updateStats(pre = false, post = false) {
      const p1 = p(m1, v1), p2 = p(m2, v2);
      const Ek1 = Ek(m1, v1), Ek2 = Ek(m2, v2);
      const totalP = p1 + p2, totalEk = Ek1 + Ek2;

      let s = '';
      s += `<div>Før støt:</div>`;
      s += `<div>v1 = ${v1.toFixed(2)} m/s, p1 = ${(p1).toFixed(2)} kg·m/s, Ek1 = ${(Ek1).toFixed(2)} J</div>`;
      s += `<div>v2 = ${v2.toFixed(2)} m/s, p2 = ${(p2).toFixed(2)} kg·m/s, Ek2 = ${(Ek2).toFixed(2)} J</div><hr>`;

      if (post) {
        s += `<div>Etter støt:</div>`;
        s += `<div>v1' = ${v1.toFixed(2)} m/s, p1' = ${(p(m1, v1)).toFixed(2)} kg·m/s, Ek1' = ${(Ek(m1, v1)).toFixed(2)} J</div>`;
        s += `<div>v2' = ${v2.toFixed(2)} m/s, p2' = ${(p(m2, v2)).toFixed(2)} kg·m/s, Ek2' = ${(Ek(m2, v2)).toFixed(2)} J</div><hr>`;
      } else {
        s += `<div>Etter støt: …</div><hr>`;
      }

      s += `<div>Total p: ${totalP.toFixed(2)} kg·m/s | Total Ek: ${totalEk.toFixed(2)} J</div>`;
      stats.innerHTML = s;
    }

    function computePostCollisionVelocities(m1, m2, v1, v2) {
      if (mode === 'elastic') {
        const v1p = ((m1 - m2)/(m1 + m2))*v1 + (2*m2/(m1 + m2))*v2;
        const v2p = (2*m1/(m1 + m2))*v1 + ((m2 - m1)/(m1 + m2))*v2;
        return [v1p, v2p];
      } else {
        const vp = (m1*v1 + m2*v2) / (m1 + m2);
        return [vp, vp];
      }
    }

    // Kollisjonstesting når kantene berører
    function isColliding() {
      return Math.abs(x1 - x2) <= (radius1 + radius2);
    }

    // Animation loop
    let last = performance.now();
    function tick(now) {
      const dt = Math.min((now - last)/1000, 0.03); // sekunder, cap for stabilitet
      last = now;
      if (running && !paused) {
        x1 += v1 * 30 * dt; // skaler for synlig fart
        x2 += v2 * 30 * dt;

        // Kollisjonshåndtering
        if (isColliding()) {
          const [nv1, nv2] = computePostCollisionVelocities(m1, m2, v1, v2);
          v1 = nv1; v2 = nv2;
          // dytt kulene litt fra hverandre for å unngå "klemming"
          const mid = (x1 + x2)/2;
          x1 = mid - radius1; x2 = mid + radius2;
          updateStats(false, true);
        }

        // Veggreflekser (valgfritt, her bare stopper vi ved kanter)
        if (x1 - radius1 < leftBound) { x1 = leftBound + radius1; v1 = Math.max(0, v1); }
        if (x2 + radius2 > rightBound) { x2 = rightBound - radius2; v2 = Math.min(0, v2); }
      }
      draw();
      requestAnimationFrame(tick);
    }

    // UI events
    function resetPositions() {
      x1 = canvas.width * 0.3;
      x2 = canvas.width * 0.7;
    }
    function readInputs() {
      m1 = parseFloat(m1El.value);
      m2 = parseFloat(m2El.value);
      v1 = parseFloat(v1El.value);
      v2 = parseFloat(v2El.value);
      mode = modeEl.value;
      updateLabels();
      updateStats(true, false);
      resetPositions();
      draw();
    }
    [m1El, m2El, v1El, v2El, modeEl].forEach(el => el.addEventListener('input', readInputs));

    startBtn.addEventListener('click', () => { running = true; paused = false; });
    pauseBtn.addEventListener('click', () => { paused = !paused; });
    resetBtn.addEventListener('click', () => { running = false; paused = false; readInputs(); });

    // Init
    readInputs();
    requestAnimationFrame(tick);
  </script>
</body>
</html>
